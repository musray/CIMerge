# ICMerge

## 规则
根据站号和点名，将AIO点同步至`ai_sheet.csv`，将DIO点同步至`di_sheet.csv`

## 开发思路

### 文件分析
本工具要处理的csv文件分为源文件和目标文件。
源文件里保存了相关变量的当前值（Value），该值需要相应写到目标文件中。

#### 文件名称
- 源文件：命名类似于`current_IC0213test_exportIC.csv`
- 目标文件：`ai_sheet.csv`和`di_sheet.csv`

#### 文件内容
- 源文件中
    - 根据`1`和`10`两列（Name和Station）可以确定一个唯一的信号
    - `2`列代表变量类型（varType）
    - `8`列的内容，即目标数据（Value）
- 目标文件中，如果目标文件的命名是`ai_sheet`，则：
    - Name信号名在`2`列
    - Station站号在`9`列
    - Value需要写到`11`列
- 目标文件中，如果文件命名是`di_sheet`，则：
    - Name信号名在`2`列
    - Station站号在`10`列
    - Value需要写到`12`列

### 程序执行过程
1. 环境校验及准备
    - 是否有指定文件夹? 继续运行 : 新建+提示+退出
    - 文件夹内是否有指定文件? 继续运行 : 提示+退出
2. 打开源文件
    - 打开源文件(csv)
    - 获得数据
3. 打开目标文件，并新建保存结果的文件
    - 逐行遍历目标文件：
        - 获得Station和Name
        - 在源文件数据中，找到该Station和Name，并获得Value（`TODO`: 这个地方是目前性能的瓶颈）
        - 将Value写入目标文件数据中
        - 将目标文件数据保存在结果文件中（sync开头的文件）

### 可能存在的问题
1. value列的值，看起来是数字，但要看实际上倒出的csv中，value到底是字符串还是数字。
2. 性能问题。

## 使用方法
1. 导出csv文件：
    - 源文件包含`exportIC`字样。
    - 目标文件为固定文件名`ai_sheet.csv`或`di_sheet.csv`
2. 在工具根目录下，新建文件夹，命名为'IC'
3. 将以上倒出的三个文件，放入IC文件夹中
4. 执行exe文件（或.py文件）
5. 新生成的文件，以`sync`开头，例如`sync_di_sheet.csv`；原始的目标文件内容不变。
